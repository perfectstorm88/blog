---
layout: post
categories: 安全 架构
---

# 案例分享
## 场景
这是我项目实施中一个经典的网络开通策略场景，作为一个系统（下面称为系统A），需要调用的服务比较多，需要提供的服务也比较多，涉及的网络区域也比较多，如下图所示：

<p align="center">
<img src="http://img.lichangzhen.top/37857943/96694251-cd0da380-13ba-11eb-8b30-9d62dc982fe8.png"  width="70%"   />
</p>

## 具体要求说明
**提供的服务：**
- 面向互联网的患者提供患者端服务
- 面向内部医生提供医生端服务，而且医生并不能直接打开，只能通过EMR才能访问

**调用的服务：**
- 调用第三方的用户信息服务，如图中的网上医院
- 调用医联中心端的模板服务

**涉及的网络区域比较多：**
- 面向互联网
- 面向医院内网区
- 面向医联内网区
- 由于医院内网和互联网隔离，中间提供了一个医院外网区，用于向互联网提供服务。

另外，还有特殊场景考虑：
- 内网服务只针对指定主机(如上图的EMR)开放服务，只有联调时才能跟EMR的人访问指定主机，那么为了自己测试方便，还需要开通一个windows主机方便自己测试用，保证windows主机能够访问你的内网服务

## 开通策略
因此一个完整的网络开通策略如下：

- 1.开通系统A外网区和系统A内网区的接口
  - 源地址：192.168.1.1（系统A外网区主机地址）
  - 目标地址:172.28.1.1(系统A内网区主机地址)
  - 目标端口：8080
- 2.开通系统A外网和互联网第三方系统(网上医院)的接口
  - 源地址：192.168.1.1（系统A外网区主机地址）
  - 目标地址：114.80.1.1  （互联网第三方系统(网上医院)）
  - 目标端口：443   不通
- 3.开通EMR访问系统A医生端的接口
  - 源地址：门诊电子病历  172.17.1.1/172.17.1.2
  - 目标地址：172.28.1.1(系统A外网区主机地址）
  - 目标端口：8080 
- 4.开通系统A内网与医联中心端的接口
  - 源地址：172.28.1.1(系统A外网区主机地址）
  - 目标地址：10.141.1.1(医联中心端)
  - 目标端口: 8080  
- 5.开通系统A外网的公网IP
  - 目标地址: 192.168.1.1（系统A外网区主机地址,需要映射为公网IP）
  - 目标端口：443
- 6.**页面操作要求：请求内网服务开放给测试主机，用于页面操作**
  - 源地址：windows测试服务器(需通过堡垒机访问)
  - 目标地址：172.28.1.1(系统A外网区主机地址）
  - 目标端口：8080


# 经验心得：

- 由于网络开通策略要走很多流程，一定要规划好，争取一次申请通过，可以节约你大量时间；上面的开通策略，看起来挺复杂，只要作为整体规划好，一条条列，最后也挺清楚的不是嘛
- 流程走完，网管开通好后，一定要及时、一条条地检查确认是否真正开通成功，毕竟是人操作的，总有疏漏。等发现问题再协调人，还得等啊等！
- 上面的目标端口只列了一个，在实际操作中，可以适当多预留几个端口，多开通几个，便于后面业务扩展时备用，毕竟再走流程还要花时间。
- 另外，一定要考虑好可测试性，端口是否连通可以自己验证，页面是否正常访问可以自己验证，别人也很忙的，若自己不能验证指望别人操作告诉你，就是瞎忙！
- 总之，设计规划的时候多花些时间，搞清楚原理，可以大大减少走流程的时间，减少出了问题再协调人的时间，效率大大滴高！
